---
- name: prepare container
  hosts: all
  gather_facts: true

  vars:

    # nginx
    #
    nginx_server_tokens: "off"
    nginx_remove_default_vhost: true

    nginx_extra_http_options: |
      map_hash_max_size 128;
      map_hash_bucket_size 128;

    nginx_vhosts:
      - listen: 80
        server_name: _
        extra_parameters: |
          location / {
            root  /var/www;
            index index.php;
            location ~ ^/index\.php(.*)$ {
              fastcgi_index          index.php;
              fastcgi_read_timeout   600;
              fastcgi_pass           unix:/run/php/worker-01.sock;
              include fastcgi_params;
            }
          }

  tasks:

    - debug:
        msg:
          - "ansible_os_family                  : {{ ansible_os_family }}"
          - "ansible_distribution               : {{ ansible_distribution }}"
          - "ansible_distribution_major_version : {{ ansible_distribution_major_version }}"
          - "ansible_version                    : {{ ansible_version.full }}"
          - "ansible_python_version             : {{ ansible_python.version.major }}"

#     - block:
#
#         - name: Install required packages on Debian
#           apt:
#             # name:
#             #   # required to add key to apt keyring
#             #   - gnupg
#             #   # required to verify icinga2 is running
#             #   - procps
#             update_cache: true
#
#         - name: Install Backports repository on Debian Stretch
#           apt_repository:
#             repo: deb http://deb.debian.org/debian {{ ansible_distribution_release }}-backports main
#             state: present
#             update_cache: true
#           when:
#             - ansible_distribution_release == 'stretch'
#
#         - name: Install apt-transport-https on older Debian/Ubuntu versions
#           apt:
#             name:
#               - apt-transport-https
#           when:
#             - ansible_distribution_release in ['jessie', 'stretch', 'xenial']
#
#       when: ansible_os_family | lower == 'debian'

  roles:
    - role: nginx
